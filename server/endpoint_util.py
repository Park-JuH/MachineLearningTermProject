import os
import numpy as np
import pandas as pd
from sagemaker.s3 import S3Downloader
from sagemaker.sklearn.model import SKLearnModel
from sagemaker import get_execution_role
from sagemaker.predictor import Predictor
from sagemaker.serializers import JSONSerializer


class EndpointUtil:
    def __init__(self, bucket_name, endpoint_name, local_folder_path, user_id: int = 97):
        print('init')
        self.user_id = user_id
        self.bucket_name = bucket_name
        self.predictor = Predictor(
            endpoint_name = endpoint_name,
            serializer = JSONSerializer()
        )
        self.note_list = ['GaiacWood', 'WarmSpicesOfWildAromaticBlackSesame', 'Lily-of-the-valley', 'BlackPepper', 'Clementine', 'Licorice', 'RedCedarWhiteMusk', 'JasminePetals', 'Plums', 'liliofthevalley', 'Cloves', 'Jasmin', 'Tea', 'PressedSicilianLemon', 'narcissus', 'Magnoli', 'AfricanGeranium', 'DriedFruit', 'RoseWater', 'Nectarine', 'sandalwood', 'MuskyWoody', 'Animal', 'Oakmoss', 'Myrrh', 'Beeswax', 'RedApple', 'Vanillaorchid', 'OakMoss', 'BourbonPepper', 'Balsamic', 'Heliotrope', 'OrangeBloosm', 'wood', 'JasmineTea', 'Rosewood', 'Pelargonium', 'InokiWood', 'WildJasmine', 'CinnamonSpices', 'IndianJasmine', 'WhiteSandalwood', 'BlackCurrant', 'WateryNotes', 'JasmineAbsolute', 'AmbretteSeeds', 'Watermelon', 'WaterLily', 'lily-of-the-valley', 'FrenchLabdanum', 'Hazelnut', 'BourbonVetiver', 'AromaticCedarwood', 'LemonWood.', 'caraway', 'Osmanthus', 'WhitePepper', 'diamondmusk', 'SweetWood', 'AgarwoodSmoke', 'Rose', 'CocaFlower', 'WhiteFlorals', 'Cocoa', 'CottonFlower', 'BalsamVetiver', 'ParaguayanLignumVitae', 'RoseDamascenaEssence', 'Ylang-Ylan', 'CoconutSalt', 'SilverMoss', 'RosedeMai', 'GingerLily', 'CrystalMoss', 'VioletLeaves', 'Masculine', 'Styrax', 'WhitePeach', 'PatchouliLeaves', 'Sugar', 'leather', 'Bluebell', 'ResinousCardamom', 'TonkaBean', 'Earthy', 'CharismaticVirilityOfACedarwood', 'MustyOud', 'tobacco.', 'Wisteria', 'Litchi', 'Patchoulie', 'marigold', 'Labdanum', 'AmberyWoods', 'ExoticWoods', 'Tonkabean', 'Carnation', 'bakhoor', 'Heliotropine', 'OakmossVetiver', 'BurningOud', 'AnimalisticFloral', 'Raspberry', 'FleurDeLys', 'Ambery', 'Lotus', 'KingWood', 'SuedeMuskSandalwoodCashmeran', 'Roseabsolute', 'ClarySage', 'LuxuriousNotesofWhiskey', 'VioletLeaf', 'RedFruits', 'SkinMusk', 'Woodsytransparentwithcoffee', 'Akigalawood', 'WhiteWood', 'BulgarianRose', 'Citric', 'Damascus', 'ChineseRose', 'Olibanum', 'Cyclamen', 'DanmaskRose', 'Oudwood', 'Davana', 'GreenTea', 'Vanille', 'CardamomWithBlackTeaLeaves', 'Wildviolet', 'Haitianvetiver', 'lotus', 'AMixOfSandalwood', 'Cedarwood', 'CentifoliaRose', 'Amyris', 'MoepelAccord', 'DelightfullySweetYlang-Ylang', 'AmberyWoody', 'Marshmallow', 'PatchouliHeart', 'AmberNuancedClarySage', 'WoodyAmber', 'Pacsuli', 'Aldehyde', 'spicynotes', 'OzonicNotes', 'Geranium', 'PacoRabanneOlympea', 'Muget', 'EbonyWood', 'MassoiaWood', 'Cashmeran', 'sichuanpepper', 'BirchLeaf', 'Apricot', 'rose', 'LiquidAmber', 'CottonCandy', 'HoneySuckle', 'BayLeaf', 'BloodOrange', 'SensualBenzoin', 'CashmirWood', 'RoseDeMaiIndian', 'Thyme', 'WarmWomanSkinAccord', 'Hyacinth', 'PowderyVanilla', 'balsamic', 'Vetiver', 'carrot', 'RoseHipRedCyclamen', 'TahitiTonka', 'PeachNectar', 'RoseOrangeBlossom', 'PineappleFlower', 'Chestnut', 'VioletRoot', 'DakotaLilies', 'Leather', 'Tobacco', 'Daffodil', 'BlueCoralAquaspaceAccord', 'bamboo', 'Blackberry', 'Woodynotes', 'Cashmerean', 'TropicalFruits', 'VanillaAbsolute', 'Rosepetals', 'WhiteMusks', 'OliveFlowerSpicedWithStarAnise', 'Sensual', 'AromaticAccords', 'DarkChocolate', 'LaosBenzoin', 'PinkFreesia', 'PreciousMusk', 'tonkabeans', 'Juniperberry', 'Vetyver', 'Pineapple', 'MadagascarVanillaAbsolute', 'GrannySmithApple', 'NaturalOudOil', 'Benzoin', 'Schijnhulst', 'OrangeFlowerAbsolute', 'benzoin', 'Musks', 'Ylang-ylang', 'BroomFlower)', 'NaturalRoseAbsolute', 'Cistus', 'GrapefruitBlossom', 'Lemon', 'RedLily', 'Lily', 'incense', 'SichuanPepper', 'Musk', 'Almond', 'Chrysanthemum', 'CashmereWoods', 'Chamomile', 'RoseAbsolute', 'gardenialilyofthevalley', 'DarkPlum', 'IndianPatchouli', 'AmberWood', 'ylang-ylang', 'PalisanderRosemary', 'geranium', 'Gardenias', 'Wood', 'Fruity', 'CitrusWood', 'pepper', 'CaramelMusk', 'PeruBalsam', 'IndianGinger', 'MilkySandalwood', 'JasmineInAnAllianceWithHibiscusBlossom', 'SeaNotes', 'GoldenAmber', 'oud', 'Ylang-Ylang', 'DriedFruits.', 'HaitianVetiver', 'Coconut', 'JasmineSambac', 'FloralAccent', 'SilverSage', 'Reseda', 'AppleBlossom', 'Rosemary', 'Guimave', 'Lamon', 'woody-amber', 'BrownSugarAccord', 'Opoponax', 'Tonka', 'LotusBlossom', 'LavenderExtract', 'Hibiscus', 'cashmereWood', 'Lavandin', 'Greenleavesoflily', 'Stephanotis', 'Ambernotes', 'HotGinger', 'BalsamFir', 'Almonds', 'CreamyMusk', 'WarmWoods', 'GuaiacTree', 'Cumin', 'LovelyVanilla', 'SaltyAmber', 'CoolEucalyptus', 'TiareFlower', 'Flowers', 'Galbanum', 'WoodyAccords', 'RoseHip', 'Sage', 'AccordsofWildStrawberry', 'Whiskey', 'Nutmeg', 'CacaoPod', 'Lily-Of-The-ValleyRose', 'Quince', 'PineTree', 'RoseAbsolu', 'LuminousOrangeBlossom', 'RippledSandAccord', 'PineApple', 'Kiwano', 'WildHyacinth', 'juniperberries', 'RangeBlossom', 'PreciousTobacco', 'Peppery', 'Salt', 'orrisroot', 'Saffron', 'Magnolia', 'WaterJasmine', 'BlueHyacinth', 'heliotrope', 'PowderyNotes', 'FloralAmberyWoody', 'BurntAmber', 'SpicySensuality-GreenPepper', 'PeonyTiare', 'DamaskRose', 'CashmereWood', 'CreamyVanilla', 'Mimosa', 'YlangYlang', 'SambacJasmine', 'TonkaBeans', 'ambroxan', 'PinkHoneysuckle', 'CandiedFruits', 'OrrangeBlossom', 'Amberwood', 'OsmanthusFlower', 'Hay', 'PowderyIris', 'Milk', 'LivelyBlackBasil', 'Fir', 'Spices', 'OrangeFlower', 'Lily-Of-The-Valley', 'FreesiaFlowers', 'exoticamethystfreesia', 'LouroAmareloWood', 'EvergreenCypress', 'softmusk', 'CreamyRosewood', 'Olivewood', 'UnexpectedCarrot', 'CreamyHoney', 'Majorjam', 'GrapefruitZests', 'AmberFat', 'Hedione', 'CashereWoods', 'WhiteAmber', 'CeylonTea', 'MarineNotes', 'OrrisRoot', 'OrrisConcrete', 'RedCader', 'petitgrain', 'AustralianSandalwood', 'OzonicTonesWithGeranium', 'guaiacwood', 'Woods', 'BlackMusk', 'FrangipaniFlower', 'Patchouli', 'Platanus', 'MuskWood', 'OrangeTreeBlossom', 'Floral', 'Toacco', 'Agarwood(Oud)', 'AmberWoods', 'TurkishRoseGardeniaCyclamen', 'SkinAccord', 'WormwoodCashmereWood', 'Haitian', 'Gardenia', 'WhiteCedarExtract', 'Essencesofrare', 'Flower', 'Exotic', 'RareWood', 'OrangeBlossomAbsolute', 'RoastedAlmonds', 'JasmineDry', 'Ginger', 'Cybet', 'Amber-like-notes', 'Pepper', 'ToluBalsam', 'Orcanox', 'RoastedTonkaGrain', 'RaspberryVilolet', 'WaterNotes', 'MexicanTuberose', 'GoldenQuince', 'AcaciaWood', 'PapyrusWood', 'leathertonkabean', 'Magnalio', 'LaotianBenzoin', 'SpicyNotesOfCarnation', 'SmallCoconut', 'BulgarianRoseAbsolute', 'AlmondBlossom', 'elegantlilyflower', 'CoconutAccords', 'Anise', 'Strawberry', 'LemonBlossom', 'Cuddly', 'pinetree', 'StarAnise', 'Carrot', 'amberwood', 'CactusFlowers', 'Lily-of-thevalley', 'Fruity-Gourmand', 'Ambergris', 'Shepherd', 'honey', 'WoodyNotes', 'TeakWood', 'FloralHarmonyofMagnolia', 'Passionfruit', 'GreenGrass', 'Fishing', 'OliveBlossom', 'WoodyAccord', 'Civet', 'LebaneseBlueCedar', 'CandiedRose', 'FloralSpicy', 'EarthyVetiver', 'Woody', 'JasminSambac', 'cypress', 'Water', 'FloralNotes', 'Pimento', 'BlackOpiumCoffee', 'gardenia', 'RoseGeranium', 'carnation', 'TahitianTiareFlowers', 'FlowersHerbShepherd', 'Turkish', 'freesia', 'MousseAustralian', 'BourbonGeranium', 'amber', 'Kiwi', 'Leathernotes', 'Clove', 'Georgywood', 'Musky', 'GuaiacWood', 'Ambroxan', 'incensetouches', 'ButterflyViolets', 'Musk-like-notes', 'IsoESuper', 'Juniper', 'SweetFruityRaspberryNuance', 'LilyOfTheValley', 'RosePetals', 'OrangeBlossoms', 'Bamboo', 'Woodsy', 'CreamyAmber', 'Mint', 'vetiver', 'HaitiVetiver', 'Almodmilk', 'GingerFlower', 'Praline', 'Lavenday', 'ylang', 'CherokeeRose', 'SicilianLemon', 'Roses', 'violet', 'ClementineZest', 'tarragon', 'RaspberryLeaf', 'SoftPeony', 'apple', 'Papyrus', 'oakmoss', 'StarApple', 'saffron', 'Bergamot', 'NeroliAbsolute', 'Orangeblossom', 'Ylang', 'GreenApple', 'SensualMusk', 'ChineseCedar', 'CitrusOrchards', 'WildRose', 'Ga√ØacWood', 'PearWood', 'Maninka', 'WoodMoss', 'VanillaStyrax', 'SouthAmericanPimento', 'VanillaLeather', 'WildHeather', 'GreyAmber', 'YellowPlum', 'DryAmber', 'Africanorange', 'PeachBlossom', 'Resin', 'Agarwood(oud)', 'Cedar', 'Subtle', 'Birch', 'PineTreeNeedles', 'SweetJasmine', 'WhiteChocolateOrchid', 'Tarragon', 'BlackViolet', 'GreenNotes', 'Plants', 'ShavingSoap', 'Frankincense', 'tonkabean', 'IndonesianPatchouli', 'ChineseOsmanthus', 'AfricanViolet', 'Basil', 'IntensivelyClean', 'Cherry', 'drywoody-amber', 'EgyptianMusk', 'Lemongrass', 'RoseTuberose', 'WhiteHeliotrope', 'Narcissus', 'Maple', 'PlamTree', 'MirabellePlum', 'Bean', 'WhiteWoods', 'MagnoliaPetals', 'FloralPetal', 'SensualAddictionOfTheTonkaBeanNote', 'Cassis', 'woodynotes', 'VanillaOrchid', 'BlackBasil', 'FloralRhythmOfPeony', 'LotusFlower', 'iris', 'Coffee', 'CopperAccords', 'FirResin', 'DryWoods.', 'Ambra', 'Cactus', 'CreamAccords', 'DamascusPlum', 'LemdDeSantal', 'HibiscusSeed', 'CedarWood', 'Whiteflowers', 'jasmin', 'tuberose', 'NeriumOleander', 'RangoonCreeper', 'VanillaPodsfromMadagascar', 'cedar', 'Cassia', 'Driftwood', 'IrisAmbergris', 'Leatherwood', 'Coriander', 'Pinetree', 'Cinnamon', 'Fern', 'lilyofthevalley', 'ArumLily', 'RoastedCocoa', 'bayleaves', 'Rice', 'BlondWood', 'Bran', 'VegetalAmber', 'BlossomPeach', 'BrazilianRosewood', 'Musk.', 'SambacJasmineAbsolute', 'mint', 'WhiteFlowers', 'EffervescentCitrus.', 'WarmSandalwood.', 'TuberRose', 'pinkpepper', 'Cashmere', 'Leathery', 'Chocolate', 'Spicy', 'MandarinOrange', 'Tubereuse', 'CoralJasmine', 'Jasmine', 'Blackcurrant', 'IndonesianPatchouliEssence', 'Incense', 'AlmondPowder', 'NutmegOil', 'LilyofTheValley', 'Seaweed', 'Grenadine', 'Calone', 'Neroli', 'mimosa', 'Oudh', 'Verbena', 'ChilledVodka', 'ElegantJasmine', 'Patchoulli', 'LabdanumRum', 'Freesia', 'CelerySeeds', 'ChampacaFlower', 'AtlasCedar', 'IndianSambacJasmine', 'EssenceOfBirch', 'Lily-of-the-Valley', 'musk', 'WildStrawberry', 'Orchid', 'DewyEnglishRoses', 'Distinct', 'Laurels', 'RosePetalAccord', 'RooibosTeaExtract(redBushTea)', 'Cupcakes', 'Sunflower', 'VanillaPod', 'Orris', 'lavender', 'Frangipani', 'Lilac', 'WhiteMusk', 'LilyoftheValley', 'aHintofFreshClementineZest', 'RedWoods', 'Creamy', 'vanilla', 'Night-BloomingJasmine', 'Cardamom', 'muguetpetals', 'Pear', 'VanillaBean', 'raspberry', 'Tob**co', 'BourbonVanilla', 'BalsaWood', 'Pine', 'MoroccanRose', 'Peach', 'TurkishRose', 'whiteFennel', 'VintageVanilla', 'Caraway', 'Caramel', 'LemonTree', 'DelicateMuskySensualWoods', 'Peony', 'Ceder', 'Amaryllis', 'BlondeLeatherPatchouliWhiteWoodsAmber', 'Agar', 'SeaNotesMixedWithSpices', 'AfricanOrangeFlower', 'RedPepper', 'CuddlyAromas', 'moss', 'Petitgrain', 'RedCurrantBlossom', 'SunflowerSeed', 'PalisanderRosewood', 'TanzanianBlackPepper', 'SandalWood', 'Rum', 'labdanum', 'Woodsy-MuskBase', 'RedBerries', 'Powdery', 'WhiteMuguet', 'Leathernote', 'Iris', 'JoshuaTree', 'jasmine', 'LightWood', 'Cashmirwood', 'Suede', 'MuskyNotes', 'Warm', 'Oriental', 'lily', 'Greenapple', 'LuidSandalwood', 'Muguet', 'LivingTempleIncense', 'ViolacioccaFlower', 'WhiteRose', 'VioletSandalwood', 'Ambrofix', 'AmbregrisAccord', 'WhiteJasmine', 'OliveTree', 'SliceOfApple', 'SensualWoods', 'Evernyl', 'TurkishRoseAbsolute', 'BlueOrrisAccord', 'Cranberries', 'VanillaPods', 'Carambola', 'BlackAmber', 'Coumarin', 'Mahogany', 'sage', 'Lily-Of-The-valley', 'IntoxicatingSeductressRose', 'MoroccanJasmine', 'CrispGreenNotes', 'Violet', 'Ebony', 'cardamom', 'PinkPepper', 'Apple', 'CaribbeanMagnolia', 'Velvet', 'CrispGreenApple', 'HimalayanCedar', 'Pink', 'Whitecedar', 'Vanilla', 'WoodyCashmeran', 'Plumeria', 'AgaveNectar', 'Orange', 'Mexicanchocolate', 'ArabicJasmine', 'Moss', 'Amber', 'Melon', 'Honeysuckle', 'Strawberries', 'Marine', 'SichaunPepper', 'Lychee', 'Moroccanjasmine', 'PatchouliLeaf', 'Oud', 'TahitianVetiver', 'LebaneseCedar', 'GuatemalanCardamom', 'Plum', 'DelicateMuskFragrance', 'Mahonial', 'Cacao', 'Teakwood', 'ChineseJasmine', 'AlmondMilk', 'RedRose', 'CedarAccords', 'CasablancaLily', 'VanillaFlowers', 'bergamot', 'SpicyNotes', 'WoodyLeather', 'SaltedVanilla', 'LusciousNarcissus', 'LavenderSage', 'JacarandaWood', 'LivingOsmanthusFlower', 'orangeblossom', 'BlackPeony', 'TailRose', 'OrangeBlossomExtract', 'Sandalwood', 'OrangeBlossom', 'BlackberryAreSoftenedWithDelicateViolet', 'JasmineTrace', 'MauritanianRedPepper', 'Honey', 'BrazilianRedwood', 'Tuberose', 'JuniperBerries', 'NightQueenFlower', 'Seanotes', 'BlackOrchid', 'Lavender', 'Elemi', 'SuedeAccord', 'GoldenWoodsMusk', 'MadagascarVanilla', 'Agarwood', 'TeaRose', 'Cypress', 'cinnamon', 'AromaticScents', 'BenzoinTolu', 'Mayrose', 'Sandalwod', 'WhiteFreesia', 'patchouli', 'VirginiaCedar', 'WoodsyNotes', 'LignumVitae', 'AmberMilk', 'HibiscusSeeds']

    def call_detail(self, satisfaction: int, buyer_gender: str, buyer_age: int, first_note: str, f_note_degree: float, second_note: str, s_note_degree: float):
        perfume_encoder_df = pd.read_csv('perfume_encoder.csv')
        selected_row = []
        selected_row.append(satisfaction)
        selected_row.append(0 if buyer_gender == 'ÎÇ®Ïûê' else 1)
        selected_row.append(buyer_age)
        for i in self.note_list:
            if first_note == i:
                selected_row.append(f_note_degree)
            elif second_note == i:
                selected_row.append(s_note_degree)
            else:
                selected_row.append(0)
        pred = self.predictor.predict([selected_row])
        print(list(pred))
        y_pred = pd.DataFrame(columns=perfume_encoder_df.columns)
        for i in (list(pred)):
            y_pred = y_pred.append(perfume_encoder_df.loc[perfume_encoder_df['type_encoded'] == i], ignore_index=True)

        return y_pred
        
        
    def call(self, specific_user_id: int):
        print(specific_user_id)
        perfume_df = pd.read_csv('processing_buyer_dataset.csv')
        perfume_encoder_df = pd.read_csv('perfume_encoder.csv')
        selected_rows = perfume_df.loc[perfume_df['user_id'] == specific_user_id]
        selected_rows = selected_rows.drop(['type_encoded', 'type', 'user_id'], axis=1)
        # endpoint call
        pred = self.predictor.predict(selected_rows.values)
        print(list(pred))
        y_pred = pd.DataFrame(columns=perfume_encoder_df.columns)
        for i in (list(pred)):
            y_pred = y_pred.append(perfume_encoder_df.loc[perfume_encoder_df['type_encoded'] == i], ignore_index=True)

        return y_pred